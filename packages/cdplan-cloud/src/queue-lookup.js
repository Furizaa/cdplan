"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.handler = void 0;
const aws_sdk_1 = require("aws-sdk");
exports.handler = async (event) => {
    var _a, _b;
    console.log('QueueLookup Request', event);
    const dynamo = new aws_sdk_1.DynamoDB.DocumentClient();
    const { token } = event.queryStringParameters;
    const item = await dynamo
        .get({
        TableName: (_a = process.env.RESULT_TABLE_NAME) !== null && _a !== void 0 ? _a : '',
        Key: { token: `${token}` },
    })
        .promise();
    if ((_b = item === null || item === void 0 ? void 0 : item.Item) === null || _b === void 0 ? void 0 : _b.payloadOut) {
        const response = {
            token,
            status: 'DONE',
            payload: JSON.parse(item.Item.payloadOut),
        };
        return {
            statusCode: 200,
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify(response),
        };
    }
    const response = {
        token,
        status: 'QUEUE',
        payload: null,
    };
    return {
        statusCode: 200,
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify(response),
    };
};
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoicXVldWUtbG9va3VwLmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsicXVldWUtbG9va3VwLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7OztBQUFBLHFDQUFtQztBQUd0QixRQUFBLE9BQU8sR0FBRyxLQUFLLEVBQUUsS0FBdUIsRUFBZ0IsRUFBRTs7SUFDckUsT0FBTyxDQUFDLEdBQUcsQ0FBQyxxQkFBcUIsRUFBRSxLQUFLLENBQUMsQ0FBQztJQUUxQyxNQUFNLE1BQU0sR0FBRyxJQUFJLGtCQUFRLENBQUMsY0FBYyxFQUFFLENBQUM7SUFFN0MsTUFBTSxFQUFFLEtBQUssRUFBRSxHQUFHLEtBQUssQ0FBQyxxQkFBcUIsQ0FBQztJQUU5QyxNQUFNLElBQUksR0FBRyxNQUFNLE1BQU07U0FDdEIsR0FBRyxDQUFDO1FBQ0gsU0FBUyxRQUFFLE9BQU8sQ0FBQyxHQUFHLENBQUMsaUJBQWlCLG1DQUFJLEVBQUU7UUFDOUMsR0FBRyxFQUFFLEVBQUUsS0FBSyxFQUFFLEdBQUcsS0FBSyxFQUFFLEVBQUU7S0FDM0IsQ0FBQztTQUNELE9BQU8sRUFBRSxDQUFDO0lBRWIsVUFBSSxJQUFJLGFBQUosSUFBSSx1QkFBSixJQUFJLENBQUUsSUFBSSwwQ0FBRSxVQUFVLEVBQUU7UUFDMUIsTUFBTSxRQUFRLEdBQXdCO1lBQ3BDLEtBQUs7WUFDTCxNQUFNLEVBQUUsTUFBTTtZQUNkLE9BQU8sRUFBRSxJQUFJLENBQUMsS0FBSyxDQUFDLElBQUksQ0FBQyxJQUFJLENBQUMsVUFBVSxDQUFDO1NBQzFDLENBQUM7UUFFRixPQUFPO1lBQ0wsVUFBVSxFQUFFLEdBQUc7WUFDZixPQUFPLEVBQUUsRUFBRSxjQUFjLEVBQUUsa0JBQWtCLEVBQUU7WUFDL0MsSUFBSSxFQUFFLElBQUksQ0FBQyxTQUFTLENBQUMsUUFBUSxDQUFDO1NBQy9CLENBQUM7S0FDSDtJQUVELE1BQU0sUUFBUSxHQUF3QjtRQUNwQyxLQUFLO1FBQ0wsTUFBTSxFQUFFLE9BQU87UUFDZixPQUFPLEVBQUUsSUFBSTtLQUNkLENBQUM7SUFFRixPQUFPO1FBQ0wsVUFBVSxFQUFFLEdBQUc7UUFDZixPQUFPLEVBQUUsRUFBRSxjQUFjLEVBQUUsa0JBQWtCLEVBQUU7UUFDL0MsSUFBSSxFQUFFLElBQUksQ0FBQyxTQUFTLENBQUMsUUFBUSxDQUFDO0tBQy9CLENBQUM7QUFDSixDQUFDLENBQUMiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBEeW5hbW9EQiB9IGZyb20gJ2F3cy1zZGsnO1xuaW1wb3J0IHsgUXVldWVMb29rdXBFdmVudCwgUXVldWVMb29rdXBSZXNwb25zZSB9IGZyb20gJy4vdHlwZXMnO1xuXG5leHBvcnQgY29uc3QgaGFuZGxlciA9IGFzeW5jIChldmVudDogUXVldWVMb29rdXBFdmVudCk6IFByb21pc2U8YW55PiA9PiB7XG4gIGNvbnNvbGUubG9nKCdRdWV1ZUxvb2t1cCBSZXF1ZXN0JywgZXZlbnQpO1xuXG4gIGNvbnN0IGR5bmFtbyA9IG5ldyBEeW5hbW9EQi5Eb2N1bWVudENsaWVudCgpO1xuXG4gIGNvbnN0IHsgdG9rZW4gfSA9IGV2ZW50LnF1ZXJ5U3RyaW5nUGFyYW1ldGVycztcblxuICBjb25zdCBpdGVtID0gYXdhaXQgZHluYW1vXG4gICAgLmdldCh7XG4gICAgICBUYWJsZU5hbWU6IHByb2Nlc3MuZW52LlJFU1VMVF9UQUJMRV9OQU1FID8/ICcnLFxuICAgICAgS2V5OiB7IHRva2VuOiBgJHt0b2tlbn1gIH0sXG4gICAgfSlcbiAgICAucHJvbWlzZSgpO1xuXG4gIGlmIChpdGVtPy5JdGVtPy5wYXlsb2FkT3V0KSB7XG4gICAgY29uc3QgcmVzcG9uc2U6IFF1ZXVlTG9va3VwUmVzcG9uc2UgPSB7XG4gICAgICB0b2tlbixcbiAgICAgIHN0YXR1czogJ0RPTkUnLFxuICAgICAgcGF5bG9hZDogSlNPTi5wYXJzZShpdGVtLkl0ZW0ucGF5bG9hZE91dCksXG4gICAgfTtcblxuICAgIHJldHVybiB7XG4gICAgICBzdGF0dXNDb2RlOiAyMDAsXG4gICAgICBoZWFkZXJzOiB7ICdDb250ZW50LVR5cGUnOiAnYXBwbGljYXRpb24vanNvbicgfSxcbiAgICAgIGJvZHk6IEpTT04uc3RyaW5naWZ5KHJlc3BvbnNlKSxcbiAgICB9O1xuICB9XG5cbiAgY29uc3QgcmVzcG9uc2U6IFF1ZXVlTG9va3VwUmVzcG9uc2UgPSB7XG4gICAgdG9rZW4sXG4gICAgc3RhdHVzOiAnUVVFVUUnLFxuICAgIHBheWxvYWQ6IG51bGwsXG4gIH07XG5cbiAgcmV0dXJuIHtcbiAgICBzdGF0dXNDb2RlOiAyMDAsXG4gICAgaGVhZGVyczogeyAnQ29udGVudC1UeXBlJzogJ2FwcGxpY2F0aW9uL2pzb24nIH0sXG4gICAgYm9keTogSlNPTi5zdHJpbmdpZnkocmVzcG9uc2UpLFxuICB9O1xufTtcbiJdfQ==